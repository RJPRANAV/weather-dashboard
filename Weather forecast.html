<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Weather Dashboard</title>

  <style>
    :root {
      --bg1: #1e3c72;
      --bg2: #2a5298;
      --card: rgba(255, 255, 255, 0.12);
      --text: #fff;
      --muted: #dfe7ff;
      --accent: #ffd166;
      --danger: #ff6b6b;
      --ok: #06d6a0;
      --shadow: 0 10px 30px rgba(0, 0, 0, 0.25);
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      color: var(--text);
      background: linear-gradient(135deg, var(--bg1), var(--bg2));
      display: grid;
      place-items: center;
      padding: 24px;
    }

    .app {
      width: 100%;
      max-width: 820px;
      background: var(--card);
      backdrop-filter: blur(8px);
      border-radius: 20px;
      box-shadow: var(--shadow);
      padding: 20px;
    }

    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      flex-wrap: wrap;
      margin-bottom: 14px;
    }

    .title {
      display: flex; align-items: center; gap: 10px;
      font-weight: 800; letter-spacing: 0.3px;
    }
    .title span.logo { font-size: 30px; }

    .searchbar { display: flex; gap: 10px; width: 100%; max-width: 520px; }
    .searchbar input {
      flex: 1;
      padding: 12px 14px;
      border: 1px solid rgba(255,255,255,0.25);
      border-radius: 12px;
      background: rgba(0,0,0,0.25);
      color: var(--text);
      outline: none;
    }
    .btn {
      padding: 12px 14px;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      color: #1a1a1a;
      background: var(--accent);
      font-weight: 700;
    }
    .btn.secondary { background: #e0e7ff; }
    .btn:disabled { opacity: 0.6; cursor: not-allowed; }

    .content { display: grid; grid-template-columns: 1.2fr 1fr; gap: 16px; }
    @media (max-width: 760px) { .content { grid-template-columns: 1fr; } }

    .card {
      background: rgba(0,0,0,0.25);
      border: 1px solid rgba(255,255,255,0.18);
      border-radius: 16px;
      padding: 16px;
      min-height: 140px;
    }

    .status { margin: 6px 0 0; font-size: 13px; color: var(--muted); }

    .current {
      display: grid;
      grid-template-columns: auto 1fr;
      gap: 16px;
      align-items: center;
    }

    .temp { font-size: 48px; font-weight: 800; line-height: 1; }
    .desc { text-transform: capitalize; color: var(--muted); margin-top: 4px; }

    .meta {
      display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 12px;
    }
    .chip {
      background: rgba(255, 255, 255, 0.12);
      border: 1px solid rgba(255,255,255,0.18);
      border-radius: 12px;
      padding: 10px;
      text-align: center;
      font-size: 14px;
    }

    .small { font-size: 12px; color: var(--muted); }

    .icon-wrap { width: 96px; height: 96px; display: grid; place-items: center; }
    .icon-wrap img { width: 96px; height: 96px; }
    .icon-emoji { font-size: 64px; }

    .footer {
      display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 8px; margin-top: 8px;
    }

    .error { color: var(--danger); font-weight: 700; }
    .success { color: var(--ok); font-weight: 700; }

    .loader { width: 22px; height: 22px; border: 3px solid rgba(255,255,255,0.35); border-top-color: var(--accent); border-radius: 50%; animation: spin 1s linear infinite; }
    @keyframes spin { to { transform: rotate(360deg) } }

    .muted-link { color: var(--muted); text-decoration: none; }
  </style>
</head>
<body>
  <div class="app" id="app">
    <header>
      <div class="title">
        <span class="logo">üå§Ô∏è</span>
        <div>Weather Dashboard</div>
      </div>
      <div class="searchbar">
        <input id="city" type="text" placeholder="Enter city (e.g., Mumbai)" autocomplete="off" />
        <button class="btn" id="searchBtn">Search</button>
        <button class="btn secondary" id="geoBtn">Use My Location</button>
      </div>
    </header>

    <div class="status" id="status">Ready.</div>

    <section class="content">
      <div class="card" id="currentCard">
        <div class="current">
          <div class="icon-wrap" id="iconWrap">
            <!-- Icon injected here -->
          </div>
          <div>
            <div id="place" style="font-weight:800; font-size:20px;">‚Äî</div>
            <div class="temp" id="temp">‚Äî</div>
            <div class="desc" id="desc">‚Äî</div>
          </div>
        </div>
        <div class="meta">
          <div class="chip">üíß Humidity<br><span id="humidity" class="small">‚Äî</span></div>
          <div class="chip">üå¨Ô∏è Wind<br><span id="wind" class="small">‚Äî</span></div>
          <div class="chip">üå°Ô∏è Feels like<br><span id="feels" class="small">‚Äî</span></div>
        </div>
        <div class="footer">
          <div class="small">Sunrise: <span id="sunrise">‚Äî</span> ¬∑ Sunset: <span id="sunset">‚Äî</span></div>
          <div class="small">Source: <span id="source">‚Äî</span></div>
        </div>
      </div>

      <div class="card">
        <div style="display:flex; align-items:center; gap:10px; margin-bottom:10px;">
          <div id="loading" class="loader" style="display:none"></div>
          <div id="message" class="small">Type a city and hit Search.</div>
        </div>
        <div class="small">Tip: Save your last search automatically.</div>
        <div style="margin-top:10px; display:flex; gap:8px; align-items:center;">
          <label class="small"><input id="remember" type="checkbox" /> Remember last city</label>
          <a class="muted-link small" href="#" id="clearSaved">Clear</a>
        </div>
      </div>
    </section>
  </div>

  <script>
    // === Configuration ===
    const OWM_API_KEY = "YOUR_API_KEY"; // ‚ñ∂Ô∏é Replace with your OpenWeatherMap key. Leave blank to always use Open‚ÄëMeteo.

    // === DOM helpers ===
    const $ = (id) => document.getElementById(id);
    const statusEl = $("status"), messageEl = $("message"), loadingEl = $("loading");

    const setStatus = (text, cls = "") => {
      statusEl.textContent = text;
      statusEl.className = `status ${cls}`.trim();
    };
    const setMessage = (text) => (messageEl.textContent = text);
    const setLoading = (on) => (loadingEl.style.display = on ? "inline-block" : "none");

    // === Icon mapping for Open‚ÄëMeteo weather codes ===
    // https://open-meteo.com/en/docs#latitude=52.52&longitude=13.41&hourly=weather_code
    const WMO_ICON = {
      0: { emoji: "‚òÄÔ∏è", text: "Clear sky" },
      1: { emoji: "üå§Ô∏è", text: "Mainly clear" },
      2: { emoji: "‚õÖ", text: "Partly cloudy" },
      3: { emoji: "‚òÅÔ∏è", text: "Overcast" },
      45: { emoji: "üå´Ô∏è", text: "Fog" },
      48: { emoji: "üå´Ô∏è", text: "Depositing rime fog" },
      51: { emoji: "üå¶Ô∏è", text: "Drizzle: light" },
      53: { emoji: "üå¶Ô∏è", text: "Drizzle: moderate" },
      55: { emoji: "üåßÔ∏è", text: "Drizzle: dense" },
      56: { emoji: "üåßÔ∏è", text: "Freezing drizzle: light" },
      57: { emoji: "üåßÔ∏è", text: "Freezing drizzle: dense" },
      61: { emoji: "üå¶Ô∏è", text: "Rain: slight" },
      63: { emoji: "üåßÔ∏è", text: "Rain: moderate" },
      65: { emoji: "üåßÔ∏è", text: "Rain: heavy" },
      66: { emoji: "üåßÔ∏è", text: "Freezing rain: light" },
      67: { emoji: "üåßÔ∏è", text: "Freezing rain: heavy" },
      71: { emoji: "üå®Ô∏è", text: "Snow fall: slight" },
      73: { emoji: "üå®Ô∏è", text: "Snow fall: moderate" },
      75: { emoji: "‚ùÑÔ∏è", text: "Snow fall: heavy" },
      77: { emoji: "‚ùÑÔ∏è", text: "Snow grains" },
      80: { emoji: "üå¶Ô∏è", text: "Rain showers: slight" },
      81: { emoji: "üåßÔ∏è", text: "Rain showers: moderate" },
      82: { emoji: "üåßÔ∏è", text: "Rain showers: violent" },
      85: { emoji: "üå®Ô∏è", text: "Snow showers: slight" },
      86: { emoji: "üå®Ô∏è", text: "Snow showers: heavy" },
      95: { emoji: "‚õàÔ∏è", text: "Thunderstorm" },
      96: { emoji: "‚õàÔ∏è", text: "Thunderstorm with slight hail" },
      99: { emoji: "‚õàÔ∏è", text: "Thunderstorm with heavy hail" },
    };

    const pad = (n) => String(n).padStart(2, "0");
    function formatTime(ts, tzOffsetSeconds = 0) {
      if (!ts) return "‚Äî";
      const d = new Date((ts + tzOffsetSeconds) * 1000);
      return `${pad(d.getUTCHours())}:${pad(d.getUTCMinutes())}`;
    }

    function setIconOWM(icon, alt) {
      $("iconWrap").innerHTML = `<img alt="${alt}" src="https://openweathermap.org/img/wn/${icon}@4x.png" />`;
    }
    function setIconEmoji(emoji, alt) {
      $("iconWrap").innerHTML = `<div class="icon-emoji" title="${alt}">${emoji}</div>`;
    }

    function saveCity(name) {
      if (!$("remember").checked) return;
      localStorage.setItem("lastCity", name);
    }
    function loadCity() {
      const c = localStorage.getItem("lastCity");
      if (c) $("city").value = c;
      return c;
    }

    async function fetchOWMByCity(city) {
      const url = new URL("https://api.openweathermap.org/data/2.5/weather");
      url.searchParams.set("q", city);
      url.searchParams.set("appid", OWM_API_KEY);
      url.searchParams.set("units", "metric");
      const res = await fetch(url);
      if (!res.ok) {
        const err = await res.json().catch(() => ({}));
        const message = err?.message || res.statusText || "OpenWeatherMap error";
        throw new Error(`OWM ${res.status}: ${message}`);
      }
      const d = await res.json();
      return {
        source: "OpenWeatherMap",
        name: d.name,
        country: d.sys?.country,
        temp: Math.round(d.main?.temp),
        feelsLike: Math.round(d.main?.feels_like),
        desc: d.weather?.[0]?.description || "",
        icon: d.weather?.[0]?.icon,
        humidity: d.main?.humidity,
        wind: d.wind?.speed,
        sunrise: d.sys?.sunrise,
        sunset: d.sys?.sunset,
        tzOffset: d.timezone || 0,
      };
    }

    async function fetchOWMByCoords(lat, lon) {
      const url = new URL("https://api.openweathermap.org/data/2.5/weather");
      url.searchParams.set("lat", lat);
      url.searchParams.set("lon", lon);
      url.searchParams.set("appid", OWM_API_KEY);
      url.searchParams.set("units", "metric");
      const res = await fetch(url);
      if (!res.ok) {
        const err = await res.json().catch(() => ({}));
        const message = err?.message || res.statusText || "OpenWeatherMap error";
        throw new Error(`OWM ${res.status}: ${message}`);
      }
      const d = await res.json();
      return {
        source: "OpenWeatherMap",
        name: d.name,
        country: d.sys?.country,
        temp: Math.round(d.main?.temp),
        feelsLike: Math.round(d.main?.feels_like),
        desc: d.weather?.[0]?.description || "",
        icon: d.weather?.[0]?.icon,
        humidity: d.main?.humidity,
        wind: d.wind?.speed,
        sunrise: d.sys?.sunrise,
        sunset: d.sys?.sunset,
        tzOffset: d.timezone || 0,
      };
    }

    async function fetchOpenMeteoByCity(city) {
      const geoURL = new URL("https://geocoding-api.open-meteo.com/v1/search");
      geoURL.searchParams.set("name", city);
      geoURL.searchParams.set("count", 1);
      geoURL.searchParams.set("language", "en");
      geoURL.searchParams.set("format", "json");
      const g = await fetch(geoURL);
      if (!g.ok) throw new Error(`Geocoding failed (${g.status})`);
      const gjson = await g.json();
      if (!gjson.results || !gjson.results.length) throw new Error("City not found");
      const loc = gjson.results[0];

      return fetchOpenMeteoByCoords(loc.latitude, loc.longitude, `${loc.name}${loc.country ? ", " + loc.country : ""}`);
    }

    async function fetchOpenMeteoByCoords(lat, lon, placeLabel = "Your location") {
      const url = new URL("https://api.open-meteo.com/v1/forecast");
      url.searchParams.set("latitude", lat);
      url.searchParams.set("longitude", lon);
      url.searchParams.set("current", "temperature_2m,relative_humidity_2m,wind_speed_10m,weather_code");
      const res = await fetch(url);
      if (!res.ok) throw new Error(`Open-Meteo ${res.status}`);
      const d = await res.json();
      const code = d.current?.weather_code;
      const icon = WMO_ICON[code] || { emoji: "üå°Ô∏è", text: "Weather" };
      return {
        source: "Open‚ÄëMeteo",
        name: placeLabel,
        country: "",
        temp: Math.round(d.current?.temperature_2m),
        feelsLike: Math.round(d.current?.temperature_2m), 
        desc: icon.text,
        iconEmoji: icon.emoji,
        humidity: d.current?.relative_humidity_2m,
        wind: d.current?.wind_speed_10m,
        sunrise: null,
        sunset: null,
        tzOffset: 0,
      };
    }

    function render(info) {
      $("place").textContent = info.country ? `${info.name}, ${info.country}` : info.name;
      $("temp").textContent = `${info.temp ?? "‚Äì"}¬∞C`;
      $("desc").textContent = info.desc || "";
      $("humidity").textContent = `${info.humidity ?? "‚Äì"}%`;
      $("wind").textContent = `${info.wind ?? "‚Äì"} m/s`;
      $("feels").textContent = `${info.feelsLike ?? "‚Äì"}¬∞C`;
      $("sunrise").textContent = info.sunrise ? formatTime(info.sunrise, info.tzOffset) : "‚Äî";
      $("sunset").textContent = info.sunset ? formatTime(info.sunset, info.tzOffset) : "‚Äî";
      $("source").textContent = info.source;

      if (info.icon) setIconOWM(info.icon, info.desc);
      else if (info.iconEmoji) setIconEmoji(info.iconEmoji, info.desc);
      else setIconEmoji("üå°Ô∏è", "Weather");
    }

    function showError(err) {
      console.error(err);
      setStatus(err.message || String(err), "error");
      setMessage("Something went wrong. Check your API key or try a different city.");
    }

    async function getByCity(city) {
      if (!city) return;
      setLoading(true);
      setStatus("Fetching weather‚Ä¶");
      setMessage("Working‚Ä¶");
      try {
        let data;
        if (OWM_API_KEY && OWM_API_KEY !== "YOUR_API_KEY") {
          try {
            data = await fetchOWMByCity(city);
          } catch (e) {
            console.warn("OWM failed, falling back:", e);
            data = await fetchOpenMeteoByCity(city);
          }
        } else {
          data = await fetchOpenMeteoByCity(city);
        }
        render(data);
        setStatus("Done", "success");
        setMessage(`Updated ‚Ä¢ ${new Date().toLocaleTimeString()}`);
        saveCity(city);
      } catch (err) {
        showError(err);
      } finally {
        setLoading(false);
      }
    }

    async function getByGeolocation() {
      if (!navigator.geolocation) {
        showError(new Error("Geolocation not supported"));
        return;
      }
      setLoading(true);
      setStatus("Getting your location‚Ä¶");
      setMessage("Requesting location permission‚Ä¶");
      navigator.geolocation.getCurrentPosition(async (pos) => {
        const { latitude, longitude } = pos.coords;
        try {
          let data;
          if (OWM_API_KEY && OWM_API_KEY !== "YOUR_API_KEY") {
            try { data = await fetchOWMByCoords(latitude, longitude); }
            catch (e) { console.warn("OWM geo failed, fallback:", e); data = await fetchOpenMeteoByCoords(latitude, longitude); }
          } else {
            data = await fetchOpenMeteoByCoords(latitude, longitude);
          }
          render(data);
          setStatus("Done", "success");
          setMessage(`Updated ‚Ä¢ ${new Date().toLocaleTimeString()}`);
        } catch (err) {
          showError(err);
        } finally {
          setLoading(false);
        }
      }, (err) => {
        showError(new Error(err.message || "Location permission denied"));
        setLoading(false);
      }, { enableHighAccuracy: true, timeout: 10000, maximumAge: 10000 });
    }

    $("searchBtn").addEventListener("click", () => getByCity($("city").value.trim()));
    $("geoBtn").addEventListener("click", getByGeolocation);
    $("city").addEventListener("keydown", (e) => { if (e.key === "Enter") getByCity($("city").value.trim()); });

    $("clearSaved").addEventListener("click", (e) => {
      e.preventDefault();
      localStorage.removeItem("lastCity");
      setMessage("Saved city cleared.");
    });

    const last = loadCity();
    if (last) {
      $("remember").checked = true;
      getByCity(last);
    }
  </script>
</body>
</html>